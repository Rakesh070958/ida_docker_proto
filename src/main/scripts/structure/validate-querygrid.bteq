bteq << EOF

/*
 * Validate-querygrid: Script for validating the server object - QueryGrid
 * author: Ana - Maria MUSAT
 */

.LOGON $servername/$superuser,$superuser_password;

.set width 200;
.set errorout stdout;


/*
* Create the users and grant the different profiles to them.
*/
CREATE USER $user_db_name_restricted FROM $env_usr AS
  PASSWORD = pass_1234,
  PERMANENT = 0,
  ACCOUNT = '$M0+$user_db_name_restricted&S&D&H$',
  PROFILE = $profile_env,
  DEFAULT ROLE = ALL,
  DEFAULT DATABASE = $landlord_tenant;

/*
* Modify the password -
* this ensures that it won't be necessary to change the password at the first login
*/

MODIFY USER $user_db_name_restricted AS PASSWORD = pass_1234;

CREATE ROLE $ro_db_name_restricted;
GRANT SELECT ON $db_name.$view_db_qg_restricted TO $ro_db_name_restricted;
GRANT $ro_db_name_restricted TO $user_db_name_restricted;

.LOGOFF;


.LOGON $ervername/$user_db_name_restricted,pass_1234;

.set width 200;
.set errorout stdout;

/* Should work */
SELECT COUNT(*) FROM $db_name.$view_db_qg_restricted;
/* Should fail */
SELECT COUNT(*) FROM $db_name.$view_db_qg;
.LOGOFF;

.QUIT;
EOF
